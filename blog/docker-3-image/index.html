<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>image 是什麼 | GC&#39;s dump</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />

  <meta name="description" content="什麼是 Docker Image？這東西可是 Docker 裡面相當重要的一個要素，沒有它就無法建立 Container，至於為什麼呢？">
<meta property="og:type" content="article">
<meta property="og:title" content="image 是什麼">
<meta property="og:url" content="htts://dreamfulfil.github.io/blog/docker-3-image/index.html">
<meta property="og:site_name" content="GC&#39;s dump">
<meta property="og:description" content="什麼是 Docker Image？這東西可是 Docker 裡面相當重要的一個要素，沒有它就無法建立 Container，至於為什麼呢？">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgur.com/6S9TBtJ.png">
<meta property="article:published_time" content="2022-01-30T08:37:00.000Z">
<meta property="article:modified_time" content="2022-01-30T08:39:51.355Z">
<meta property="article:author" content="George Chou">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/6S9TBtJ.png">

  
    <link rel="alternate" href="/atom.xml" title="GC&#39;s dump" type="application/atom+xml" />
  

  

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Material+Icons|Raleway:400,300,700" rel="stylesheet" type="text/css" />

  
<link rel="stylesheet" href="/generated/668-8ba6742167ba420f699c.css">

<link rel="stylesheet" href="/generated/app-da20bb8e781d1cdeb855.css">

<link rel="stylesheet" href="/generated/blog-9616c73356b85ed396f8.css">


  


  <script src="https://polyfill.io/v3/polyfill.min.js?features=es5,es6,es7,fetch,Object.entries,Object.values&flags=gated"></script>

<meta name="generator" content="Hexo 6.0.0"></head>
<body>

  
<div class="navbar-fixed">
  <nav id="main-navbar" class="grey lighten-5 z-depth-0" role="navigation">
    <div class="nav-wrapper container">

      <a id="logo-container" href="/" class="brand-logo center-align">
        <span>GC&#39;s dump</span>
        <sub>Study Notes and Sharing Techinal Knowledge</sub>
      </a>

      <ul class="right hide-on-med-and-down">
        
          <li>
            <a class="main-nav-link" href="/">Home</a>
          </li>
        
          <li>
            <a class="main-nav-link" href="/blog">Blog</a>
          </li>
        
      </ul>

      <a href="#" data-target="nav-mobile" class="button-collapse sidenav-trigger">
        <i class="material-icons">menu</i>
      </a>
    </div>
  </nav>
</div>

<ul id="nav-mobile" class="sidenav">
  
  <li>
    <a class="main-nav-link" href="/">Home</a>
  </li>
  
  <li>
    <a class="main-nav-link" href="/blog">Blog</a>
  </li>
  
</ul>


  <div id="main-container">
    
<div class="container">
  <div class="row">
    <div class="col s12">


      <article id="post-docker-3-image" class="article article-type-post" itemscope itemprop="blogPost">

        <div class="article-inner">
          


          <header class="article-header">
          
              
  
    <h1 class="article-title header" itemprop="name">
      image 是什麼
    </h1>
  


          

            
              <div class="article-meta">
                <i class="fa fa-calendar"></i>
                Published:
                <time
                  datetime="2022-01-30T08:37:00.000Z"
                  itemprop="datePublished"
                  title="Date published"
                >Jan 30, 2022</time>

                
                  -
                  Updated:
                  <time
                    datetime="2022-01-30T08:39:51.355Z"
                    itemprop="dateModified"
                    title="Date updated"
                  >Jan 30, 2022</time>
                
              </div>
            
          </header>


          <div class="article-entry " itemprop="articleBody">
            
              <p>什麼是 <strong>Docker Image</strong>？<br>這東西可是 Docker 裡面相當重要的一個要素，<br>沒有它就無法建立 Container，至於為什麼呢？</p>
<span id="more"></span>
<h3 id="組成"><a href="#組成" class="headerlink" title="組成"></a>組成</h3><ul>
<li>正確來說 Image 是 Layers of Image，如果以<strong>盤子</strong>比喻的話，大概就是<strong>一疊盤子</strong></li>
<li>就是你會在資料結構的書上看到的堆疊結構那個樣子，我個人稱之為 <strong>Layers of Image</strong>，</li>
<li>每一一個 Image layer，其內容物為一個含有多個 File 的 Filesystem，透過一個叫作 <strong>Union File System 的技術</strong> 將每一個層結合再一起，讓你「<strong>看起來</strong>」是只有一個 Filesystem。</li>
</ul>
<h3 id="建立"><a href="#建立" class="headerlink" title="建立"></a>建立</h3><ul>
<li>這每一層的 Layer 又是怎麼形成的呢？</li>
<li>必須要透過一個叫 <strong>Dockerfile</strong> 的指令腳本來指示建立</li>
<li>Dockerfile 的每一條指令，從 <strong>FROM, RUN, COPY, … ENTRYPOINT</strong> 等等，都會先建立一個<strong>暫時的 container</strong>，執行完指令之後，把結果記錄成一個 image layer，而最後最後的結果，其實就是最後一個指令執行完的 image layer 的 ID</li>
<li>以下是一個 Dockerfile 的範例:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># nginx state for serving content</span><br><span class="line">FROM --platform=linux/amd64 nginx:alpine</span><br><span class="line"># Set working directory to nginx asset directory</span><br><span class="line">WORKDIR /usr/share/nginx/html</span><br><span class="line"># Remove default nginx static assets</span><br><span class="line">RUN rm -rf ./*</span><br><span class="line"># COPY the result of ng build --prod to WORKDIR</span><br><span class="line">COPY dist/avc-frontend .</span><br><span class="line"></span><br><span class="line">COPY default.conf /etc/nginx/conf.d/default.conf</span><br><span class="line"># Containers run nginx with global directives and daemon off</span><br><span class="line">ENTRYPOINT [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></pre></td></tr></table></figure></li>
<li>如果想看完整的一個 image 總共有多少 layers，可以透過 <strong>docker history</strong>，如下:<br>  <img src="https://i.imgur.com/6S9TBtJ.png"></li>
</ul>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul>
<li>在我們執行 <strong>docker run</strong> 的時候，就會在這一個 Layers of image 的頂端建立一個<strong>可讀寫</strong>的 layer</li>
<li>這意味著了「那一層」之外，所有以下的 Image layer 都是<strong>唯讀</strong>的，因此這些唯讀的 Image Layer 在不同的 container 間是<strong>可以共用</strong>的</li>
<li><strong>共用</strong>意味著相同內容的 Image layer，就只需要下載一份即可</li>
<li>這也是為什麼有時候在 docker pull 或是 docker build 的時候可以看到 <strong>use cache</strong>，因為已經有相同內容物的 Image layer 存在了，直接拿來使用就好了。</li>
</ul>
<h3 id="結論"><a href="#結論" class="headerlink" title="結論:"></a>結論:</h3><ul>
<li>container 是一個 linux process</li>
<li>container 本身所能讀或寫的 filesystem 就是所有唯讀的 image layer 組合起來，再加上它自己可讀寫的那一層</li>
<li>image 是透過 Dockerfile 所寫的腳本透過 docker engine 產出來的</li>
</ul>

            
          </div>

          

          <footer class="article-footer">
            <a data-url="htts://dreamfulfil.github.io/blog/docker-3-image/" data-id="ckz10fok70000qzhk4jrk2g2d" class="article-share-link">Share</a>
            
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Docker/" rel="tag">Docker</a></li></ul>

          </footer>

        </div>

        
          
<nav id="article-nav" class="white">
  <div class="nav-wrapper">
    <ul>
    

    
      <li id="article-nav-older-container">
        <a
          href="/blog/docker-2-%E4%BB%80%E9%BA%BC%E6%98%AFdocker/"
          id="article-nav-older"
          class="article-nav-link-wrap grey-text text-darken-1 right-align"
          title="Docker 是什麼"
        >
          <span class="article-nav-title truncate">Docker 是什麼</span>
          <i class="fa fa-arrow-right"></i>
        </a>
      </li>
    

    </ul>
  </div>
</nav>


        
      </article>


      



    </div>
  </div>
</div>


  




  </div>

  <footer class="page-footer grey darken-2">
    <div class="footer-copyright">
      <div class="container">
        &copy; 2022 George Chou

        <div class="right">
          Powered by <a href="http://hexo.io/" rel="nofollow noopener" class="white-text" target="_blank">Hexo</a>
        </div>
      </div>
    </div>
  </footer>

  
<script src="/generated/193-eb01f81907d23513bb6f.js"></script>

<script src="/generated/668-d2e471b8dcd3790fc287.js"></script>

<script src="/generated/app-ab934fe8b0db342c4d01.js"></script>

<script src="/generated/blog-11990083fd519e2cb9b8.js"></script>


</body>
</html>
